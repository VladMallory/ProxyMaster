package common

import tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"

// Глобальные переменные конфигурации
var (
	BOT_TOKEN              string
	ADMIN_ID               int64
	PANEL_URL              string
	PANEL_USER             string
	PANEL_PASS             string
	INBOUND_ID             int
	CONFIG_BASE_URL        string
	CONFIG_JSON_URL        string
	REDIRECT_DOMAIN        string
	REDIRECT_IMPORT        string // Тип импорта: "happ" или "v2raytun"
	PRICE_PER_DAY          int
	TRIAL_BALANCE_AMOUNT   int
	TRAFFIC_LIMIT_GB       int
	TRAFFIC_RESET_ENABLED  bool
	TRAFFIC_RESET_INTERVAL int
	TRAFFIC_CHECK_INTERVAL int
	SHOW_DATES_IN_CONFIGS  bool
	SUPPORT_LINK           string

	// IP Ban система - управление конфигами на основе количества IP адресов
	IP_BAN_ENABLED       bool   // Включена ли система IP бана
	MAX_IPS_PER_CONFIG   int    // Максимальное количество IP адресов на один конфиг
	ACCESS_LOG_PATH      string // Путь к файлу access.log
	IP_ACCUMULATED_PATH  string // Путь к файлу накопленных логов
	IP_BAN_LOG_PATH      string // Путь к файлу логов IP ban
	IP_SAVE_INTERVAL     int    // Интервал сохранения новых строк в минутах
	IP_CHECK_INTERVAL    int    // Интервал проверки IP в минутах
	IP_BAN_GRACE_PERIOD  int    // Период ожидания в минутах перед отключением конфига
	IP_BAN_DURATION      int    // Длительность бана в минутах (0 = бесконечно)
	IP_COUNTER_RETENTION int    // Время хранения счетчиков IP в минутах (0 = бесконечно)
	IP_CLEANUP_INTERVAL  int    // Интервал очистки старых данных в часах

	// Глобальный бот для отправки уведомлений
	GlobalBot *tgbotapi.BotAPI // Глобальный экземпляр бота

	// Автосписание
	AUTO_BILLING_ENABLED    bool // Включено ли автосписание за каждый день
	BALANCE_RECALC_INTERVAL int  // Интервал пересчета дней по балансу в минутах
	TARIFF_MODE_ENABLED     bool // Включен ли режим тарифов (false = автосписание, true = тарифы)

	// Настройки уведомлений о подписке
	NOTIFICATION_ENABLED        bool   // Включены ли уведомления о подписке
	NOTIFICATION_CHECK_INTERVAL int    // Интервал проверки подписок в минутах
	NOTIFICATION_DAYS_BEFORE    []int  // За сколько дней до истечения отправлять уведомления
	NOTIFICATION_MESSAGE_1_DAY  string // Сообщение за 1 день до истечения
	NOTIFICATION_MESSAGE_3_DAYS string // Сообщение за 3 дня до истечения
	NOTIFICATION_MESSAGE_7_DAYS string // Сообщение за 7 дней до истечения

	// Уведомления для администратора
	ADMIN_NOTIFICATIONS_ENABLED   bool // Включены ли уведомления для администратора
	ADMIN_CONFIG_BLOCKING_ENABLED bool // Уведомления админу о блокировке конфигов (автосписание)
	ADMIN_IP_BAN_ENABLED          bool // Уведомления админу о срабатывании IP ban
	ADMIN_BALANCE_TOPUP_ENABLED   bool // Уведомления админу о пополнении баланса
	ADMIN_REFERRAL_ENABLED        bool // Уведомления админу о новых рефералах

	// === НАСТРОЙКИ ПЛАТЕЖЕЙ ===

	// Настройки ЮКассы через Telegram Bot API
	YUKASSA_PROVIDER_TOKEN    string // Токен провайдера платежей от BotFather
	TELEGRAM_PAYMENTS_ENABLED bool   // Включены ли платежи через Telegram Bot API

	// Настройки прямой интеграции с ЮКассы (API)
	YUKASSA_SHOP_ID              string // ID магазина ЮКассы
	YUKASSA_SECRET_KEY           string // Секретный ключ ЮКассы
	YUKASSA_API_PAYMENTS_ENABLED bool   // Включены ли платежи через прямое API ЮКассы
	YUKASSA_WEBHOOK_URL          string // URL для получения уведомлений от ЮКассы

	// Настройки чеков для ЮКассы
	YUKASSA_RECEIPT_ENABLED bool   // Включена ли отправка чеков
	YUKASSA_VAT_CODE        int    // Код НДС (1=20%, 2=10%, 3=0%, 4=без НДС, 5=20/120, 6=10/110)
	YUKASSA_PAYMENT_SUBJECT string // Предмет расчета (service, commodity, etc.)
	YUKASSA_PAYMENT_MODE    string // Способ расчета (full_prepayment, partial_prepayment, advance, full_payment, partial_payment, credit, credit_payment)

	// === НАСТРОЙКИ РЕФЕРАЛЬНОЙ СИСТЕМЫ ===
	REFERRAL_SYSTEM_ENABLED      bool    // Включена ли реферальная система
	REFERRAL_BONUS_AMOUNT        float64 // Сумма бонуса для пригласившего (в рублях)
	REFERRAL_WELCOME_BONUS       float64 // Сумма бонуса для приглашенного (в рублях)
	REFERRAL_LINK_BASE_URL       string  // Базовый URL для реферальных ссылок
	REFERRAL_MIN_BALANCE_FOR_REF float64 // Минимальный баланс для получения реферальной ссылки
)

// Инициализация глобальных переменных конфигурации
func init() {
	// Эти значения должны быть загружены из переменных окружения или конфигурационного файла
	BOT_TOKEN = "YOUR_BOT_TOKEN_HERE" // Замените на ваш токен бота от @BotFather
	ADMIN_ID = 123456789               // Замените на ваш Telegram ID

	// URL для панели управления
	PANEL_URL = "https://your-panel.example.com:4803/your-path/"
	PANEL_USER = "your_panel_username"
	PANEL_PASS = "your_panel_password"
	INBOUND_ID = 1

	// URL для конфигураций
	CONFIG_BASE_URL = "https://your-config.example.com:3052/your-config-path/"
	CONFIG_JSON_URL = "https://your-config.example.com:3052/your-json-path/"

	REDIRECT_DOMAIN = "your-redirect.example.com:8081" // редирект для импорта подписки
	REDIRECT_IMPORT = "v2raytun"                       // тип импорта: "happ" или "v2raytun"

	// ---TRAFIC---
	TRAFFIC_RESET_ENABLED = true   // включен ли автоматический сброс трафика
	PRICE_PER_DAY = 1              // стоимость подписки за день
	TRIAL_BALANCE_AMOUNT = 50      // сумма в рублях, которая добавляется при активации пробного периода (минимум = PRICE_PER_DAY)
	TRAFFIC_LIMIT_GB = 70          // лимиты трафика. Срок действия указывается в TRAFFIC_RESET_INTERVAL
	TRAFFIC_RESET_INTERVAL = 10080 // 7 дней в минутах (7*24*60 = 8640)
	TRAFFIC_CHECK_INTERVAL = 1440  // как часто бот проверяет, не превысил ли пользователь лимит трафика

	// если 300 гигов на месяц, то 70 гигов в неделю
	// если 200 гигов на месяц, то 46 гигов в неделю
	// если 100 гигов на месяц, то 23 гигов в неделю

	// ---IP Ban---
	IP_BAN_ENABLED = true                               // Включена ли система IP бана
	ACCESS_LOG_PATH = "/usr/local/x-ui/access.log"      // Путь к файлу access.log
	IP_ACCUMULATED_PATH = "/var/log/ip_accumulated.log" // Путь к файлу накопленных логов
	IP_BAN_LOG_PATH = "/root/bot/bot.log"               // Путь к файлу логов IP ban
	MAX_IPS_PER_CONFIG = 4                              // Максимальное количество IP адресов на один конфиг (если больше - отключается)
	IP_SAVE_INTERVAL = 25                               // Интервал сохранения новых строк в минутах
	IP_CHECK_INTERVAL = 25                              // Интервал проверки IP в минутах
	IP_BAN_DURATION = 120                               // Длительность бана в минутах (1 час)
	IP_COUNTER_RETENTION = 20                           // Время хранения счетчиков IP в минутах (3 часа - в 3 раза больше времени бана для стабильной работы)
	IP_CLEANUP_INTERVAL = 1                             // Интервал очистки старых данных в часах
	// не используется
	IP_BAN_GRACE_PERIOD = 10 // Период ожидания в минутах перед отключением конфига (10 минут). Сейчас не работает

	// ---ПРОЧИЕ НАСТРОЙКИ---
	// Показывать ли даты в именах конфигов - если true, то в email будет
	// "123456789 до 2025 03 09", если false, то просто "123456789"
	SHOW_DATES_IN_CONFIGS = false

	// Ссылка на поддержку - куда направлять пользователей при нажатии на кнопку "Поддержка"
	SUPPORT_LINK = "https://t.me/your_support_channel"

	// ---АВТОСПИСАНИЕ---
	AUTO_BILLING_ENABLED = true    // Включено ли автосписание за каждый день
	BALANCE_RECALC_INTERVAL = 1440 // Интервал пересчета дней по балансу в минутах (24 часа - страховочная проверка)
	TARIFF_MODE_ENABLED = false    // Включен ли режим тарифов (false = автосписание, true = тарифы)

	// ---НАСТРОЙКИ УВЕДОМЛЕНИЙ О ПОДПИСКЕ---
	NOTIFICATION_ENABLED = false              // Включены ли уведомления о подписке (отключено для автосписания)
	NOTIFICATION_CHECK_INTERVAL = 60          // Интервал проверки подписок в минутах (1 час)
	NOTIFICATION_DAYS_BEFORE = []int{1, 3, 7} // За сколько дней до истечения отправлять уведомления
	NOTIFICATION_MESSAGE_1_DAY = "⚠️ <b>Ваша подписка истекает завтра!</b>\n\n" +
		"Не забудьте продлить подписку, чтобы не потерять доступ к VPN.\n\n" +
		"Нажмите /balance для просмотра баланса и продления."
	NOTIFICATION_MESSAGE_3_DAYS = "🔔 <b>Напоминание о подписке</b>\n\n" +
		"Ваша подписка истекает через 3 дня.\n" +
		"Рекомендуем продлить её заранее.\n\n" +
		"Нажмите /balance для просмотра баланса и продления."
	NOTIFICATION_MESSAGE_7_DAYS = "📅 <b>Уведомление о подписке</b>\n\n" +
		"Ваша подписка истекает через неделю.\n" +
		"Не забудьте пополнить баланс и продлить подписку.\n\n" +
		"Нажмите /balance для просмотра баланса и продления."

	// ---УВЕДОМЛЕНИЯ ДЛЯ АДМИНИСТРАТОРА---
	ADMIN_NOTIFICATIONS_ENABLED = true   // Включены ли уведомления для администратора
	ADMIN_CONFIG_BLOCKING_ENABLED = true // Уведомления админу о блокировке конфигов (автосписание)
	ADMIN_IP_BAN_ENABLED = true          // Уведомления админу о срабатывании IP ban
	ADMIN_BALANCE_TOPUP_ENABLED = true   // Уведомления админу о пополнении баланса
	ADMIN_REFERRAL_ENABLED = true        // Уведомления админу о новых рефералах

	// ---НАСТРОЙКИ ПЛАТЕЖЕЙ---

	// === TELEGRAM BOT API ПЛАТЕЖИ ===
	// Использует интеграцию через Telegram Bot API
	// Режим (тест/прод) определяется типом токена от BotFather (TEST/LIVE)
	YUKASSA_PROVIDER_TOKEN = "YOUR_PROVIDER_TOKEN_HERE" // Токен от BotFather
	TELEGRAM_PAYMENTS_ENABLED = false                   // Отключить платежи через Telegram

	// === ПРЯМОЕ API ЮКАССЫ ===
	// Использует прямую интеграцию с API ЮКассы
	YUKASSA_SHOP_ID = "YOUR_SHOP_ID"                                    // ID магазина ЮКассы
	YUKASSA_SECRET_KEY = "live_YOUR_SECRET_KEY_HERE"                   // Секретный ключ ЮКассы
	YUKASSA_API_PAYMENTS_ENABLED = true                                 // Включить платежи через прямое API
	YUKASSA_WEBHOOK_URL = "https://your-domain.example.com:8081/yukassa/webhook" // URL для уведомлений от ЮКассы

	// === НАСТРОЙКИ ЧЕКОВ ===
	YUKASSA_RECEIPT_ENABLED = true           // Включить отправку чеков (обязательно для 54-ФЗ)
	YUKASSA_VAT_CODE = 1                     // НДС 20% (1=20%, 2=10%, 3=0%, 4=без НДС, 5=20/120, 6=10/110)
	YUKASSA_PAYMENT_SUBJECT = "service"      // Услуга (service, commodity, excise, job, gambling_bet, gambling_prize, lottery, lottery_prize, intellectual_activity, payment, agent_commission, composite, another)
	YUKASSA_PAYMENT_MODE = "full_prepayment" // Полная предоплата (full_prepayment, partial_prepayment, advance, full_payment, partial_payment, credit, credit_payment)

	// === НАСТРОЙКИ РЕФЕРАЛЬНОЙ СИСТЕМЫ ===
	REFERRAL_SYSTEM_ENABLED = true                                    // Включена ли реферальная система
	REFERRAL_BONUS_AMOUNT = 500.0                                     // Сумма бонуса для пригласившего (в рублях)
	REFERRAL_WELCOME_BONUS = 500.0                                    // Сумма бонуса для приглашенного (в рублях)
	REFERRAL_LINK_BASE_URL = "https://t.me/your_bot_username?start=ref_" // Базовый URL для реферальных ссылок
	REFERRAL_MIN_BALANCE_FOR_REF = 0.0                                // Минимальный баланс для получения реферальной ссылки
}