package common

import tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"

// Глобальные переменные конфигурации
var (
	BOT_TOKEN              string
	ADMIN_ID               int64
	PANEL_URL              string
	PANEL_USER             string
	PANEL_PASS             string
	INBOUND_ID             int
	CONFIG_BASE_URL        string
	CONFIG_JSON_URL        string
	REDIRECT_DOMAIN        string
	REDIRECT_IMPORT        string // Тип импорта: "happ" или "v2raytun"
	PRICE_PER_DAY          int
	TRIAL_BALANCE_AMOUNT   int
	TRAFFIC_LIMIT_GB       int
	TRAFFIC_RESET_ENABLED  bool
	TRAFFIC_RESET_INTERVAL int
	TRAFFIC_CHECK_INTERVAL int
	SHOW_DATES_IN_CONFIGS  bool
	SUPPORT_LINK           string

	// IP Ban система - управление конфигами на основе количества IP адресов
	IP_BAN_ENABLED       bool   // Включена ли система IP бана
	MAX_IPS_PER_CONFIG   int    // Максимальное количество IP адресов на один конфиг
	ACCESS_LOG_PATH      string // Путь к файлу access.log
	IP_ACCUMULATED_PATH  string // Путь к файлу накопленных логов
	IP_BAN_LOG_PATH      string // Путь к файлу логов IP ban
	IP_SAVE_INTERVAL     int    // Интервал сохранения новых строк в минутах
	IP_CHECK_INTERVAL    int    // Интервал проверки IP в минутах
	IP_BAN_GRACE_PERIOD  int    // Период ожидания в минутах перед отключением конфига
	IP_BAN_DURATION      int    // Длительность бана в минутах (0 = бесконечно)
	IP_COUNTER_RETENTION int    // Время хранения счетчиков IP в минутах (0 = бесконечно)
	IP_CLEANUP_INTERVAL  int    // Интервал очистки старых данных в часах

	// Глобальный бот для отправки уведомлений
	GlobalBot *tgbotapi.BotAPI // Глобальный экземпляр бота

	// Автосписание
	AUTO_BILLING_ENABLED    bool // Включено ли автосписание за каждый день
	BALANCE_RECALC_INTERVAL int  // Интервал пересчета дней по балансу в минутах
	TARIFF_MODE_ENABLED     bool // Включен ли режим тарифов (false = автосписание, true = тарифы)

	// Настройки уведомлений о подписке
	NOTIFICATION_ENABLED        bool   // Включены ли уведомления о подписке
	NOTIFICATION_CHECK_INTERVAL int    // Интервал проверки подписок в минутах
	NOTIFICATION_DAYS_BEFORE    []int  // За сколько дней до истечения отправлять уведомления
	NOTIFICATION_MESSAGE_1_DAY  string // Сообщение за 1 день до истечения
	NOTIFICATION_MESSAGE_3_DAYS string // Сообщение за 3 дня до истечения
	NOTIFICATION_MESSAGE_7_DAYS string // Сообщение за 7 дней до истечения

	// Уведомления для администратора
	ADMIN_NOTIFICATIONS_ENABLED   bool // Включены ли уведомления для администратора
	ADMIN_CONFIG_BLOCKING_ENABLED bool // Уведомления админу о блокировке конфигов (автосписание)
	ADMIN_IP_BAN_ENABLED          bool // Уведомления админу о срабатывании IP ban
	ADMIN_BALANCE_TOPUP_ENABLED   bool // Уведомления админу о пополнении баланса

	// === НАСТРОЙКИ ПЛАТЕЖЕЙ ===
	
	// Настройки ЮКассы через Telegram Bot API
	YUKASSA_PROVIDER_TOKEN      string // Токен провайдера платежей от BotFather
	TELEGRAM_PAYMENTS_ENABLED   bool   // Включены ли платежи через Telegram Bot API
	
	// Настройки прямой интеграции с ЮКассы (API)
	YUKASSA_SHOP_ID             string // ID магазина ЮКассы
	YUKASSA_SECRET_KEY          string // Секретный ключ ЮКассы
	YUKASSA_API_PAYMENTS_ENABLED bool   // Включены ли платежи через прямое API ЮКассы
	YUKASSA_WEBHOOK_URL         string // URL для получения уведомлений от ЮКассы
	
	// Настройки чеков для ЮКассы
	YUKASSA_RECEIPT_ENABLED      bool   // Включена ли отправка чеков
	YUKASSA_VAT_CODE             int    // Код НДС (1=20%, 2=10%, 3=0%, 4=без НДС, 5=20/120, 6=10/110)
	YUKASSA_PAYMENT_SUBJECT      string // Предмет расчета (service, commodity, etc.)
	YUKASSA_PAYMENT_MODE         string // Способ расчета (full_prepayment, partial_prepayment, advance, full_payment, partial_payment, credit, credit_payment)
)

// Инициализация глобальных переменных конфигурации
func init() {
	// Эти значения должны быть загружены из переменных окружения или конфигурационного файла
	BOT_TOKEN = "YOUR_BOT_TOKEN_HERE" // Получите токен у @BotFather
	ADMIN_ID = 123456789              // Замените на ваш Telegram ID

	// URL для панели управления
	PANEL_URL = "https://your-domain.com:port/panel_path/"
	PANEL_USER = "your_panel_username"
	PANEL_PASS = "your_panel_password"
	INBOUND_ID = 5

	// URL для конфигураций
	CONFIG_BASE_URL = "https://your-domain.com:port/sub/"
	CONFIG_JSON_URL = "https://your-domain.com:port/json/"

	REDIRECT_DOMAIN = "your-domain.com:port" // редирект для импорта подписки
	REDIRECT_IMPORT = "happ"                 // тип импорта: "happ" или "v2raytun"

	// ---TRAFIC---
	TRAFFIC_RESET_ENABLED = true   // включен ли автоматический сброс трафика
	PRICE_PER_DAY = 50             // стоимость подписки за день
	TRIAL_BALANCE_AMOUNT = 50      // сумма в рублях, которая добавляется при активации пробного периода (минимум = PRICE_PER_DAY)
	TRAFFIC_LIMIT_GB = 70          // лимиты трафика. Срок действия указывается в TRAFFIC_RESET_INTERVAL
	TRAFFIC_RESET_INTERVAL = 10080 // 7 дней в минутах (7*24*60 = 8640)
	TRAFFIC_CHECK_INTERVAL = 1440  // как часто бот проверяет, не превысил ли пользователь лимит трафика

	// если 300 гигов на месяц, то 70 гигов в неделю
	// если 200 гигов на месяц, то 46 гигов в неделю
	// если 100 гигов на месяц, то 23 гигов в неделю

	// ---IP Ban---
	IP_BAN_ENABLED = true                               // Включена ли система IP бана
	ACCESS_LOG_PATH = "/usr/local/x-ui/access.log"      // Путь к файлу access.log
	IP_ACCUMULATED_PATH = "/var/log/ip_accumulated.log" // Путь к файлу накопленных логов
	IP_BAN_LOG_PATH = "/path/to/your/bot.log"           // Путь к файлу логов IP ban
	MAX_IPS_PER_CONFIG = 1                              // Максимальное количество IP адресов на один конфиг (если больше - отключается)
	IP_SAVE_INTERVAL = 25                               // Интервал сохранения новых строк в минутах
	IP_CHECK_INTERVAL = 25                              // Интервал проверки IP в минутах
	IP_BAN_DURATION = 120                               // Длительность бана в минутах (1 час)
	IP_COUNTER_RETENTION = 20                           // Время хранения счетчиков IP в минутах (3 часа - в 3 раза больше времени бана для стабильной работы)
	IP_CLEANUP_INTERVAL = 1                             // Интервал очистки старых данных в часах
	// не используется
	IP_BAN_GRACE_PERIOD = 10 // Период ожидания в минутах перед отключением конфига (10 минут). Сейчас не работает

	// ---ПРОЧИЕ НАСТРОЙКИ---
	// Показывать ли даты в именах конфигов - если true, то в email будет
	// "123456789 до 2025 03 09", если false, то просто "123456789"
	SHOW_DATES_IN_CONFIGS = false

	// Ссылка на поддержку - куда направлять пользователей при нажатии на кнопку "Поддержка"
	SUPPORT_LINK = "https://t.me/your_support_channel"

	// ---АВТОСПИСАНИЕ---
	AUTO_BILLING_ENABLED = true    // Включено ли автосписание за каждый день
	BALANCE_RECALC_INTERVAL = 1440 // Интервал пересчета дней по балансу в минутах (24 часа - страховочная проверка)
	TARIFF_MODE_ENABLED = false    // Включен ли режим тарифов (false = автосписание, true = тарифы)

	// ---НАСТРОЙКИ УВЕДОМЛЕНИЙ О ПОДПИСКЕ---
	NOTIFICATION_ENABLED = false              // Включены ли уведомления о подписке (отключено для автосписания)
	NOTIFICATION_CHECK_INTERVAL = 60          // Интервал проверки подписок в минутах (1 час)
	NOTIFICATION_DAYS_BEFORE = []int{1, 3, 7} // За сколько дней до истечения отправлять уведомления
	NOTIFICATION_MESSAGE_1_DAY = "⚠️ <b>Ваша подписка истекает завтра!</b>\n\n" +
		"Не забудьте продлить подписку, чтобы не потерять доступ к VPN.\n\n" +
		"Нажмите /balance для просмотра баланса и продления."
	NOTIFICATION_MESSAGE_3_DAYS = "🔔 <b>Напоминание о подписке</b>\n\n" +
		"Ваша подписка истекает через 3 дня.\n" +
		"Рекомендуем продлить её заранее.\n\n" +
		"Нажмите /balance для просмотра баланса и продления."
	NOTIFICATION_MESSAGE_7_DAYS = "📅 <b>Уведомление о подписке</b>\n\n" +
		"Ваша подписка истекает через неделю.\n" +
		"Не забудьте пополнить баланс и продлить подписку.\n\n" +
		"Нажмите /balance для просмотра баланса и продления."

	// ---УВЕДОМЛЕНИЯ ДЛЯ АДМИНИСТРАТОРА---
	ADMIN_NOTIFICATIONS_ENABLED = true   // Включены ли уведомления для администратора
	ADMIN_CONFIG_BLOCKING_ENABLED = true // Уведомления админу о блокировке конфигов (автосписание)
	ADMIN_IP_BAN_ENABLED = true          // Уведомления админу о срабатывании IP ban
	ADMIN_BALANCE_TOPUP_ENABLED = true   // Уведомления админу о пополнении баланса

	// ---НАСТРОЙКИ ПЛАТЕЖЕЙ---
	
	// === TELEGRAM BOT API ПЛАТЕЖИ ===
	// Для получения токена: @BotFather -> Bot Settings -> Payments -> Connect ЮKassa
	// Режим определяется типом токена: TEST для тестирования, LIVE для продакшна
	YUKASSA_PROVIDER_TOKEN = "YOUR_YUKASSA_PROVIDER_TOKEN_FROM_BOTFATHER" // Токен от BotFather
	TELEGRAM_PAYMENTS_ENABLED = true // Включить платежи через Telegram (true/false)
	
	// === ПРЯМОЕ API ЮКАССЫ ===
	// Для получения данных: ЮKassa личный кабинет -> Настройки -> API
	YUKASSA_SHOP_ID = "YOUR_YUKASSA_SHOP_ID"         // ID магазина ЮКассы
	YUKASSA_SECRET_KEY = "YOUR_YUKASSA_SECRET_KEY"   // Секретный ключ ЮКассы
	YUKASSA_API_PAYMENTS_ENABLED = false            // Включить платежи через прямое API (true/false)
	YUKASSA_WEBHOOK_URL = "https://yourdomain.com/yukassa/webhook" // URL для уведомлений от ЮКассы
	
	// === НАСТРОЙКИ ЧЕКОВ ===
	YUKASSA_RECEIPT_ENABLED = true     // Включить отправку чеков (обязательно для 54-ФЗ)
	YUKASSA_VAT_CODE = 1              // НДС 20% (1=20%, 2=10%, 3=0%, 4=без НДС, 5=20/120, 6=10/110)
	YUKASSA_PAYMENT_SUBJECT = "service" // Услуга (service, commodity, excise, job, gambling_bet, gambling_prize, lottery, lottery_prize, intellectual_activity, payment, agent_commission, composite, another)
	YUKASSA_PAYMENT_MODE = "full_prepayment" // Полная предоплата (full_prepayment, partial_prepayment, advance, full_payment, partial_payment, credit, credit_payment)
}